{
  "version": "1.0",
  "lastUpdated": "2025-09-16T00:00:00Z",
  "description": "CDN Caching and Security Policies for OptimaCore",
  "cachePolicies": [
    {
      "name": "Images",
      "description": "Caching policy for image files",
      "fileExtensions": [".jpg", ".jpeg", ".png", ".gif", ".webp", ".svg", ".ico"],
      "cacheControl": "public, max-age=31536000",
      "edgeCaching": true,
      "compression": true
    },
    {
      "name": "Videos",
      "description": "Caching policy for video files",
      "fileExtensions": [".mp4", ".webm", ".ogg", ".mov", ".m3u8", ".ts"],
      "cacheControl": "public, max-age=86400",
      "edgeCaching": true,
      "byteRangeRequests": true
    },
    {
      "name": "Static Assets",
      "description": "Caching policy for static assets (JS, CSS, fonts)",
      "fileExtensions": [".js", ".css", ".woff", ".woff2", ".ttf", ".eot"],
      "cacheControl": "public, max-age=31536000, immutable",
      "edgeCaching": true,
      "compression": true
    },
    {
      "name": "Documents",
      "description": "Caching policy for document files",
      "fileExtensions": [".pdf", ".doc", ".docx", ".xls", ".xlsx", ".ppt", ".pptx", ".txt"],
      "cacheControl": "public, max-age=3600",
      "edgeCaching": true
    },
    {
      "name": "Default",
      "description": "Default caching policy for all other files",
      "cacheControl": "public, max-age=600",
      "edgeCaching": true
    }
  ],
  "securityHeaders": {
    "strictTransportSecurity": "max-age=31536000; includeSubDomains; preload",
    "xContentTypeOptions": "nosniff",
    "xFrameOptions": "SAMEORIGIN",
    "xXSSProtection": "1; mode=block",
    "contentSecurityPolicy": "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:; connect-src 'self'"
  },
  "compression": {
    "enabled": true,
    "types": ["text/plain", "text/css", "text/html", "text/javascript", "application/javascript", "application/json", "application/xml", "image/svg+xml"]
  },
  "geoFiltering": {
    "enabled": false,
    "action": "Allow",
    "countryCodes": []
  },
  "rateLimiting": {
    "enabled": true,
    "rateLimitRule": [
      {
        "name": "General",
        "matchCondition": {
          "matchVariable": "RequestUri"
        },
        "action": {
          "type": "Block",
          "responseStatus": 429,
          "responseBody": "Rate limit exceeded. Please try again later."
        },
        "priority": 1,
        "rateLimitThreshold": 100,
        "rateLimitDurationInMinutes": 1
      }
    ]
  },
  "healthProbe": {
    "path": "/health",
    "intervalInSeconds": 30,
    "unhealthyThreshold": 3
  },
  "logging": {
    "enabled": true,
    "retentionDays": 30,
    "storageAccount": "${AZURE_STORAGE_ACCOUNT_NAME}",
    "container": "cdn-logs"
  },
  "monitoring": {
    "azureMonitor": {
      "enabled": true,
      "metrics": ["RequestCount", "RequestSizeBytes", "ResponseSizeBytes", "TotalLatency", "BackendLatency"]
    },
    "alerts": [
      {
        "name": "HighErrorRate",
        "description": "Alert when error rate exceeds 5%",
        "metric": "Http4xx,Http5xx",
        "operator": "GreaterThan",
        "threshold": 5,
        "windowSize": "PT5M",
        "evaluationFrequency": "PT5M"
      },
      {
        "name": "HighLatency",
        "description": "Alert when average latency exceeds 1 second",
        "metric": "TotalLatency",
        "operator": "GreaterThan",
        "threshold": 1000,
        "windowSize": "PT5M",
        "evaluationFrequency": "PT5M"
      }
    ]
  },
  "customDomains": [
    {
      "name": "${CUSTOM_DOMAIN}",
      "hostname": "${CUSTOM_DOMAIN}",
      "certificateSource": "Cdn",
      "protocolType": "HttpsOnly",
      "minimumTlsVersion": "TLS12"
    }
  ]
}
